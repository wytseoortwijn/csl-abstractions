<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Programs</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Programs</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Bool</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">HahnBase</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Heaps</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Morphisms</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Permissions</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Prelude</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Process</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ProcMap</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Setoid</span>.<br/>

<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab131"></a><h1 class="section">Programs</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Type</span> <span class="id" title="var">Programs</span><br/>
&nbsp;&nbsp;(<span class="id" title="var">dom</span> : <span class="id" title="var">Domains</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">heaps</span> : <span class="id" title="var">Heaps</span> <span class="id" title="var">dom</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">procs</span> : <span class="id" title="var">Processes</span> <span class="id" title="var">dom</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="var">procmaps</span> : <span class="id" title="var">ProcMaps</span> <span class="id" title="var">dom</span> <span class="id" title="var">heaps</span> <span class="id" title="var">procs</span>).<br/>

<br/>
<span class="id" title="keyword">Export</span> <span class="id" title="var">dom</span> <span class="id" title="var">heaps</span> <span class="id" title="var">procs</span> <span class="id" title="var">procmaps</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab132"></a><h2 class="section">Statics</h2>

<div class="paragraph"> </div>

<a name="lab133"></a><h3 class="section">Expressions</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Expr</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Econst</span>(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Evar</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Eop</span>(<span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">Expr</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Expr_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Expr_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Expr_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Expr_sind".<br/>

<br/>
</div>

<div class="doc">
Below is a helper tactic for doing induction
    on the structure of (program) expressions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">expr_induction</span> <span class="id" title="var">E</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">v</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">E2</span> <span class="id" title="var">IH2</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Expressions have decidable equality. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eq_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">Expr</span>, { <span class="id" title="var">E1</span> = <span class="id" title="var">E2</span> } + { <span class="id" title="var">E1</span> &lt;&gt; <span class="id" title="var">E2</span> }.<br/>

<br/>
</div>

<div class="doc">
<a name="lab134"></a><h4 class="section">Conversions</h4>

<div class="paragraph"> </div>

 The following operation converts process expressions
    to program expressions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pexpr_convert</span> (<span class="id" title="var">e</span> : <span class="id" title="var">ProcExpr</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>) : <span class="id" title="var">Expr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">Econst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEop</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">Eop</span> (<span class="id" title="var">pexpr_convert</span> <span class="id" title="var">e1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">pexpr_convert</span> <span class="id" title="var">e2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab135"></a><h4 class="section">Free variables</h4>

<div class="paragraph"> </div>

 Free variables of expressions are defined in the standard way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">expr_fv</span> (<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Econst</span> <span class="id" title="var">v</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Evar</span> <span class="id" title="var">x</span> =&gt; [<span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">expr_fv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">expr_fv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">expr_map_fv</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">t</span> : <span class="id" title="var">T</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> (<span class="id" title="var">f</span> <span class="id" title="var">t</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab136"></a><h4 class="section">Substitution</h4>

<div class="paragraph"> </div>

 Substitution within expressions is defined in the standard way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">expr_subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> <span class="id" title="var">E'</span> : <span class="id" title="var">Expr</span>) : <span class="id" title="var">Expr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E'</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Econst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">Econst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Evar</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">var_eq_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">E</span> <span class="id" title="keyword">else</span> <span class="id" title="var">Evar</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">Eop</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E1</span>) (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">expr_subst_map</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>) : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">y</span> : <span class="id" title="var">T</span> =&gt; <span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span>).<br/>

<br/>
</div>

<div class="doc">
Standard properties of substitution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_subst_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> <span class="id" title="var">x</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E1</span>) -&gt; <span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E2</span> <span class="id" title="var">E1</span> = <span class="id" title="var">E1</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_subst_pres_map</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>) <span class="id" title="var">E</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">expr_map_fv</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">expr_subst_map</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">f</span> = <span class="id" title="var">f</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_subst_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">x1</span> &lt;&gt; <span class="id" title="var">x2</span> -&gt;<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x1</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E2</span>) -&gt;<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x2</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E1</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_subst</span> <span class="id" title="var">x1</span> <span class="id" title="var">E1</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x2</span> <span class="id" title="var">E2</span> <span class="id" title="var">E</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_subst</span> <span class="id" title="var">x2</span> <span class="id" title="var">E2</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x1</span> <span class="id" title="var">E1</span> <span class="id" title="var">E</span>).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_subst_comm_val</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">x1</span> <span class="id" title="var">x2</span> <span class="id" title="var">v1</span> <span class="id" title="var">v2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">x1</span> &lt;&gt; <span class="id" title="var">x2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_subst</span> <span class="id" title="var">x1</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v1</span>) (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x2</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v2</span>) <span class="id" title="var">E</span>) =<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_subst</span> <span class="id" title="var">x2</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v2</span>) (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x1</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v1</span>) <span class="id" title="var">E</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab137"></a><h3 class="section">Hybrid expressions</h3>

<div class="paragraph"> </div>

 Hybrid expressions are expressions that have both
    program variables and process variables (and are thus
    a hybrid between <span class="inlinecode"><span class="id" title="var">Expr</span></span> and <span class="inlinecode"><span class="id" title="var">ProcExpr</span></span>). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">HExpr</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">HEconst</span>(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span>(<span class="id" title="var">x</span> : <span class="id" title="var">ProcVar</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HEop</span>(<span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">HExpr</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HExpr_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HExpr_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HExpr_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HExpr_sind".<br/>

<br/>
</div>

<div class="doc">
Below is a helper tactic for doing induction
    on the structure of hybrid expressions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">hexpr_induction</span> <span class="id" title="var">E</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">v</span>|<span class="id" title="var">x</span>|<span class="id" title="var">x</span>|<span class="id" title="var">E1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">E2</span> <span class="id" title="var">IH2</span>].<br/>

<br/>
</div>

<div class="doc">
<a name="lab138"></a><h4 class="section">Free variables</h4>

<div class="paragraph"> </div>

 The following operation determines the set of free
    <i>program</i> variables in a hybrid expression. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hexpr_fv</span> (<span class="id" title="var">E</span> : <span class="id" title="var">HExpr</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEconst</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span> <span class="id" title="var">x</span> =&gt; [<span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">hexpr_fv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">hexpr_fv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
And the following is for determining the set of
    free <i>process</i> variables in hybrid expressions 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hexpr_fpv</span> (<span class="id" title="var">E</span> : <span class="id" title="var">HExpr</span>) : <span class="id" title="var">list</span> <span class="id" title="var">ProcVar</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEconst</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span> <span class="id" title="var">x</span> =&gt; [<span class="id" title="var">x</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab139"></a><h4 class="section">Hybridisation</h4>

<div class="paragraph"> </div>

 The following operation allows to make a hybrid expression
    out of an ordinary expression. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">peHybridise</span> (<span class="id" title="var">e</span> : <span class="id" title="var">ProcExpr</span>) : <span class="id" title="var">HExpr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">e</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">HEprocvar</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PEop</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">HEop</span> (<span class="id" title="var">peHybridise</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">peHybridise</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">eHybridise</span> (<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>) : <span class="id" title="var">HExpr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Econst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Evar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">HEprogvar</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">HEop</span> (<span class="id" title="var">eHybridise</span> <span class="id" title="var">E1</span>) (<span class="id" title="var">eHybridise</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab140"></a><h4 class="section">Conversions</h4>

<div class="paragraph"> </div>

 Below is an operation that converts hybrid expressions to
    ordinary program expressions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hexpr_convert</span> (<span class="id" title="var">E</span> : <span class="id" title="var">HExpr</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>) : <span class="id" title="var">Expr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">Econst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">f</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">Evar</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">Eop</span> (<span class="id" title="var">hexpr_convert</span> <span class="id" title="var">E1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">hexpr_convert</span> <span class="id" title="var">E2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab141"></a><h3 class="section">Conditions</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Cond</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Bconst</span>(<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Bnot</span>(<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Band</span>(<span class="id" title="var">B1</span> <span class="id" title="var">B2</span> : <span class="id" title="var">Cond</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Beq</span>(<span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">Expr</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cond_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cond_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cond_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cond_sind".<br/>

<br/>
</div>

<div class="doc">
Below is a helper tactic for doing induction
    on the structure of (program) conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">cond_induction</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">B</span> <span class="id" title="keyword">as</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">B2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E1</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Conditions have decidable equality. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_eq_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> : <span class="id" title="var">Cond</span>, { <span class="id" title="var">B1</span> = <span class="id" title="var">B2</span> } + { <span class="id" title="var">B1</span> &lt;&gt; <span class="id" title="var">B2</span> }.<br/>

<br/>
</div>

<div class="doc">
Some sugar 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Bor</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> := <span class="id" title="var">Bnot</span> (<span class="id" title="var">Band</span> (<span class="id" title="var">Bnot</span> <span class="id" title="var">B1</span>) (<span class="id" title="var">Bnot</span> <span class="id" title="var">B2</span>)).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Bimplies</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> := <span class="id" title="var">Bor</span> (<span class="id" title="var">Bnot</span> <span class="id" title="var">B1</span>) <span class="id" title="var">B2</span>.<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Bequiv</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> := <span class="id" title="var">Band</span> (<span class="id" title="var">Bimplies</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span>) (<span class="id" title="var">Bimplies</span> <span class="id" title="var">B2</span> <span class="id" title="var">B1</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab142"></a><h4 class="section">Conversions</h4>

<div class="paragraph"> </div>

 The following operation converts process conditions
    to program conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pcond_convert</span> (<span class="id" title="var">b</span> : <span class="id" title="var">ProcCond</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>) : <span class="id" title="var">Cond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBconst</span> <span class="id" title="var">b'</span> =&gt; <span class="id" title="var">Bconst</span> <span class="id" title="var">b'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBnot</span> <span class="id" title="var">b'</span> =&gt; <span class="id" title="var">Bnot</span> (<span class="id" title="var">pcond_convert</span> <span class="id" title="var">b'</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBand</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> =&gt; <span class="id" title="var">Band</span> (<span class="id" title="var">pcond_convert</span> <span class="id" title="var">b1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">pcond_convert</span> <span class="id" title="var">b2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBeq</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">Beq</span> (<span class="id" title="var">pexpr_convert</span> <span class="id" title="var">e1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">pexpr_convert</span> <span class="id" title="var">e2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab143"></a><h4 class="section">Free variables</h4>

<div class="paragraph"> </div>

 Free variables of conditions are defined in the standard way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cond_fv</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bconst</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">cond_fv</span> <span class="id" title="var">B'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Band</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">cond_fv</span> <span class="id" title="var">B1</span> ++ <span class="id" title="var">cond_fv</span> <span class="id" title="var">B2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Beq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">expr_fv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">expr_fv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab144"></a><h4 class="section">Substitution</h4>

<div class="paragraph"> </div>

 Substitution within conditions is defined in the standard way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cond_subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>) : <span class="id" title="var">Cond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bconst</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">Bconst</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">Bnot</span> (<span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Band</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">Band</span> (<span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B1</span>) (<span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Beq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">Beq</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E1</span>) (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Standard properties of substitution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_subst_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">E</span> <span class="id" title="var">x</span>, ~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span> = <span class="id" title="var">B</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab145"></a><h3 class="section">Hybrid conditions</h3>

<div class="paragraph"> </div>

 Hybrid conditions are conditions that have both
    program variables and process variables (and are thus
    a hybrid between <span class="inlinecode"><span class="id" title="var">Cond</span></span> and <span class="inlinecode"><span class="id" title="var">ProcCond</span></span>). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">HCond</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">HBconst</span>(<span class="id" title="var">b</span> : <span class="id" title="var">bool</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HBnot</span>(<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HBand</span>(<span class="id" title="var">B1</span> <span class="id" title="var">B2</span> : <span class="id" title="var">HCond</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HBeq</span>(<span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">HExpr</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HCond_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HCond_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HCond_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HCond_sind".<br/>

<br/>
</div>

<div class="doc">
Below is a helper tactic for doing induction
    on the structure of hybrid conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">hcond_induction</span> <span class="id" title="var">B</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">B</span> <span class="id" title="keyword">as</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">b</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">B2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E1</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
<a name="lab146"></a><h4 class="section">Free variables</h4>

<div class="paragraph"> </div>

 The following operation determines the set of free
    <i>program</i> variables in a hybrid condition. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hcond_fv</span> (<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>) : <span class="id" title="var">list</span> <span class="id" title="var">Var</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBconst</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">hcond_fv</span> <span class="id" title="var">B'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBand</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">hcond_fv</span> <span class="id" title="var">B1</span> ++ <span class="id" title="var">hcond_fv</span> <span class="id" title="var">B2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBeq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">hexpr_fv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">hexpr_fv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
And the following operation determines the set of free
    <i>process</i> variables in hybrid conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hcond_fpv</span> (<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>) : <span class="id" title="var">list</span> <span class="id" title="var">ProcVar</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBconst</span> <span class="id" title="var">_</span> =&gt; []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">hcond_fpv</span> <span class="id" title="var">B'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBand</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">hcond_fpv</span> <span class="id" title="var">B1</span> ++ <span class="id" title="var">hcond_fpv</span> <span class="id" title="var">B2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBeq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E1</span> ++ <span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab147"></a><h4 class="section">Hybridisation</h4>

<div class="paragraph"> </div>

 The following operation enables one to construct hybrid
    conditions out of ordinary (program) conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pcHybridise</span> (<span class="id" title="var">b</span> : <span class="id" title="var">ProcCond</span>) : <span class="id" title="var">HCond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">b</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HBconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBnot</span> <span class="id" title="var">b'</span> =&gt; <span class="id" title="var">HBnot</span> (<span class="id" title="var">pcHybridise</span> <span class="id" title="var">b'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBand</span> <span class="id" title="var">b1</span> <span class="id" title="var">b2</span> =&gt; <span class="id" title="var">HBand</span> (<span class="id" title="var">pcHybridise</span> <span class="id" title="var">b1</span>) (<span class="id" title="var">pcHybridise</span> <span class="id" title="var">b2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PBeq</span> <span class="id" title="var">e1</span> <span class="id" title="var">e2</span> =&gt; <span class="id" title="var">HBeq</span> (<span class="id" title="var">peHybridise</span> <span class="id" title="var">e1</span>) (<span class="id" title="var">peHybridise</span> <span class="id" title="var">e2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cHybridise</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>) : <span class="id" title="var">HCond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HBconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">HBnot</span> (<span class="id" title="var">cHybridise</span> <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Band</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">HBand</span> (<span class="id" title="var">cHybridise</span> <span class="id" title="var">B1</span>) (<span class="id" title="var">cHybridise</span> <span class="id" title="var">B2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Beq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">HBeq</span> (<span class="id" title="var">eHybridise</span> <span class="id" title="var">E1</span>) (<span class="id" title="var">eHybridise</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab148"></a><h4 class="section">Conversions</h4>

<div class="paragraph"> </div>

 The following operation is for converting hybrid conditions
    to ordinary program conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hcond_convert</span> (<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>) : <span class="id" title="var">Cond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBconst</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">Bconst</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">Bnot</span> (<span class="id" title="var">hcond_convert</span> <span class="id" title="var">B'</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBand</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">Band</span> (<span class="id" title="var">hcond_convert</span> <span class="id" title="var">B1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">hcond_convert</span> <span class="id" title="var">B2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBeq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">Beq</span> (<span class="id" title="var">hexpr_convert</span> <span class="id" title="var">E1</span> <span class="id" title="var">f</span>) (<span class="id" title="var">hexpr_convert</span> <span class="id" title="var">E2</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab149"></a><h3 class="section">Hybrid processes</h3>

<div class="paragraph"> </div>

 Hybrid processes <span class="inlinecode"><span class="id" title="var">P</span></span> are ordinary processes in which
    any (Boolean) expression occuring inside <span class="inlinecode"><span class="id" title="var">P</span></span> may contain
    program variables (in addition to process variables). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">HProc</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPepsilon</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">HPdelta</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">HPact</span>(<span class="id" title="var">a</span> : <span class="id" title="var">Act</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPassert</span>(<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPseq</span>(<span class="id" title="var">P1</span> <span class="id" title="var">P2</span> : <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPalt</span>(<span class="id" title="var">P1</span> <span class="id" title="var">P2</span> : <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPpar</span>(<span class="id" title="var">P1</span> <span class="id" title="var">P2</span> : <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPlmerge</span>(<span class="id" title="var">P1</span> <span class="id" title="var">P2</span> : <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPsum</span>(<span class="id" title="var">f</span> : <span class="id" title="var">Val</span> -&gt; <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPcond</span>(<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">HPiter</span>(<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HProc_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HProc_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HProc_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "HProc_sind".<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">HPsum_ext</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">f</span> <span class="id" title="var">f'</span>, <span class="id" title="var">f</span> = <span class="id" title="var">f'</span> -&gt; <span class="id" title="var">HPsum</span> <span class="id" title="var">f</span> = <span class="id" title="var">HPsum</span> <span class="id" title="var">f'</span>.<br/>
 
<br/>
</div>

<div class="doc">
Below is a shorthand tactic for doing induction
    on the inductive structure of hybrid processes. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">hproc_induction</span> <span class="id" title="var">P</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">P</span> <span class="id" title="keyword">as</span> [<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">a</span> <span class="id" title="var">E</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">P2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">P2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">P2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">P2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">f</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">P</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">P</span> <span class="id" title="var">IH</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
<a name="lab150"></a><h4 class="section">Free variables</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hproc_fv</span> (<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">P</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPepsilon</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPdelta</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPact</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPassert</span> <span class="id" title="var">B</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hcond_fv</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPseq</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPalt</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPpar</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPlmerge</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">R</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPsum</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">v</span>, <span class="id" title="var">hproc_fv</span> (<span class="id" title="var">f</span> <span class="id" title="var">v</span>) <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPcond</span> <span class="id" title="var">B</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>) \/ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPiter</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">hproc_fv</span> <span class="id" title="var">Q</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab151"></a><h4 class="section">Hybridisation</h4>

<div class="paragraph"> </div>

 The following operation enables one to construct a
    hybrid process out of an ordinary process. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pHybridise</span> (<span class="id" title="var">P</span> : <span class="id" title="var">Proc</span>) : <span class="id" title="var">HProc</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">P</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pepsilon</span> =&gt; <span class="id" title="var">HPepsilon</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pdelta</span> =&gt; <span class="id" title="var">HPdelta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pact</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HPact</span> <span class="id" title="var">a</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Passert</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">HPassert</span> (<span class="id" title="var">pcHybridise</span> <span class="id" title="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pseq</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">HPseq</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">pHybridise</span> <span class="id" title="var">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Palt</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">HPalt</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">pHybridise</span> <span class="id" title="var">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Ppar</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">HPpar</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">pHybridise</span> <span class="id" title="var">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Plmerge</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> =&gt; <span class="id" title="var">HPlmerge</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">pHybridise</span> <span class="id" title="var">R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Psum</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">HPsum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">pHybridise</span> (<span class="id" title="var">f</span> <span class="id" title="var">v</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Pcond</span> <span class="id" title="var">b</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">HPcond</span> (<span class="id" title="var">Bconst</span> <span class="id" title="var">b</span>) (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Piter</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">HPiter</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab152"></a><h3 class="section">Commands</h3>

<div class="paragraph"> </div>

 Commands are parameterised by a type, which is the type of the
    metadata that is stored in action blocks (see the <span class="inlinecode"><span class="id" title="var">Cinact</span></span> constructor).
    We later define a ghost operational semantics (in which the metadata
    component is used to maintain extra runtime information
    regarding abstract models. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">Cmd</span> (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">Cseq</span>(<span class="id" title="var">C1</span> <span class="id" title="var">C2</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cass</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cread</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span>(<span class="id" title="var">E1</span> <span class="id" title="var">E2</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cite</span>(<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>)(<span class="id" title="var">C1</span> <span class="id" title="var">C2</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span>(<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>)(<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cpar</span>(<span class="id" title="var">C1</span> <span class="id" title="var">C2</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Calloc</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span>(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Catomic</span>(<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span>(<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cproc</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">Expr</span> -&gt; <span class="id" title="var">HProc</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProcVar</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cact</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">a</span> : <span class="id" title="var">Act</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cinact</span>(<span class="id" title="var">m</span> : <span class="id" title="var">T</span>)(<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cquery</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span>(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cmd_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cmd_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cmd_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "Cmd_sind".<br/>

<br/>

<br/>
</div>

<div class="doc">
A shorthand for doing induction over commands: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">cmd_induction</span> <span class="id" title="var">C</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">C</span> <span class="id" title="keyword">as</span> [|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">C2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">E</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">E</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E1</span> <span class="id" title="var">E2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">C2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C1</span> <span class="id" title="var">IH1</span> <span class="id" title="var">C2</span> <span class="id" title="var">IH2</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">E</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">C</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">Pf</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">m</span> <span class="id" title="var">C</span> <span class="id" title="var">IH</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span><br/>
&nbsp;&nbsp;].<br/>

<br/>
</div>

<div class="doc">
Some standard properties over the structure of commands. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_neg_seq</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C2</span> <span class="id" title="var">C1</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, ~ <span class="id" title="var">C2</span> = <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_neg_ite_t</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C1</span> <span class="id" title="var">C2</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">B</span>, ~ <span class="id" title="var">C1</span> = <span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_neg_ite_f</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C2</span> <span class="id" title="var">C1</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">B</span>, ~ <span class="id" title="var">C2</span> = <span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab153"></a><h4 class="section">Plain commands</h4>

<div class="paragraph"> </div>

 Plain commands are commands without metadata components
    (or, technically, these are commands in which the metadata type is
    fixed and chosen to have only one inhabitant, namely <span class="inlinecode"><span class="id" title="var">PMnone</span></span>). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">PlainMetadata</span> := <span class="id" title="var">PMnone</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PlainMetadata_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PlainMetadata_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PlainMetadata_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "PlainMetadata_sind".<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">PlainCmd</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Cmd</span> <span class="id" title="var">PlainMetadata</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">plain</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) : <span class="id" title="var">PlainCmd</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">Cseq</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C1</span>) (<span class="id" title="var">plain</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">Cass</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">Cite</span> <span class="id" title="var">B</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C1</span>) (<span class="id" title="var">plain</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">Cpar</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C1</span>) (<span class="id" title="var">plain</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">Catomic</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">Cinatom</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">Cproc</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">Cact</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">Cquery</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">Cinact</span> <span class="id" title="var">PMnone</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">Cendproc</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">plain_skip</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">plain</span> <span class="id" title="var">C</span> = <span class="id" title="var">Cskip</span> -&gt; <span class="id" title="var">C</span> = <span class="id" title="var">Cskip</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab154"></a><h4 class="section">User programs</h4>

<div class="paragraph"> </div>

 Any program is a <i>user program</i> if it does not contain
    <span class="inlinecode"><span class="id" title="var">Cinact</span></span> or <span class="inlinecode"><span class="id" title="var">Cinatom</span></span> as a subprogram. 
<div class="paragraph"> </div>

 The program <span class="inlinecode"><span class="id" title="var">Cinatom</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span> represents an atomic program <span class="inlinecode"><span class="id" title="var">C</span></span>
    that is only partially executed. Such programs cannot be written
    by a user but are an artifact of the program dynamics.
    The same holds for <span class="inlinecode"><span class="id" title="var">Cinact</span></span> <span class="inlinecode"><span class="id" title="var">m</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span>, which describes a partially
    executed action program <span class="inlinecode"><span class="id" title="var">C</span></span> (and is a specification-only
    command besides). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_user</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_user</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_user</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_user</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_user</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_user_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">cmd_user</span> <span class="id" title="var">C</span> = <span class="id" title="var">cmd_user</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab155"></a><h4 class="section">Locked programs</h4>

<div class="paragraph"> </div>

 Any program is defined to be <i>locked</i>
    if it contains <span class="inlinecode"><span class="id" title="var">Cinatom</span></span> as a subprogram. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_locked</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> \/ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> =&gt; <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_locked_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">cmd_locked</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) = <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab156"></a><h4 class="section">Well-formed programs</h4>

<div class="paragraph"> </div>

 Any program is defined to be <i>basic</i> if it does not
    contain any process-related commands, and if there are
    no deadlocks in any of its parallel subprograms. 
<div class="paragraph"> </div>

 Any program is <i>well-formed</i> if <span class="inlinecode"><span class="id" title="var">C</span></span> is basic for every
    subcommand <span class="inlinecode"><span class="id" title="var">Cact</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span> that occurs in the program, and if
    there are no deadlocks in any of its parallel subprograms,
    likewise to basic programs. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_basic</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C2</span> /\ ~ (<span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_wf</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C2</span> /\ ~ (<span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> /\ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Any basic program is well-formed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_basic_wf</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab157"></a><h4 class="section">Free variables</h4>

<div class="paragraph"> </div>

 The free variables of commands are defined in the standard way. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_fv</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">y</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">y</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">y</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E1</span>) \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>) \/ <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C1</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C2</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>) \/ <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C1</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C2</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">y</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> = <span class="id" title="var">y</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>) \/ <span class="id" title="var">expr_map_fv</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">v</span>, <span class="id" title="var">hproc_fv</span> (<span class="id" title="var">P</span> <span class="id" title="var">v</span>) <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> <span class="id" title="var">E</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span> \/ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>) \/ <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_fv_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> = <span class="id" title="var">cmd_fv</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab158"></a><h4 class="section">Modified variables</h4>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">cmd_mod</span></span> captures the set of variables
    that are <i>modified</i> (written to) by a given program,
    and is defined in the standard way (however, note that,
    for later convenience, <span class="inlinecode"><span class="id" title="var">cmd_mod</span></span> is defined as a predicate,
    rather than a fixpoint operation that yields a list of variables). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_mod</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C1</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C2</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">y</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">x</span> = <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
All variables written to by <span class="inlinecode"><span class="id" title="var">C</span></span> occur freely in <span class="inlinecode"><span class="id" title="var">C</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_fv_mod</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>), <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_mod_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>, <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> = <span class="id" title="var">cmd_mod</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab159"></a><h2 class="section">Dynamics</h2>

<div class="paragraph"> </div>

<a name="lab160"></a><h3 class="section">Stores</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">Store</span> := <span class="id" title="var">Var</span> -&gt; <span class="id" title="var">Val</span>.<br/>

<br/>
</div>

<div class="doc">
An update operation for stores: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sUpdate</span> (<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>)(<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>) : <span class="id" title="var">Store</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">update</span> <span class="id" title="var">var_eq_dec</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sUpdate_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">s</span> <span class="id" title="var">x1</span> <span class="id" title="var">v1</span> <span class="id" title="var">x2</span> <span class="id" title="var">v2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">x1</span> &lt;&gt; <span class="id" title="var">x2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">sUpdate</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x1</span> <span class="id" title="var">v1</span>) <span class="id" title="var">x2</span> <span class="id" title="var">v2</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">sUpdate</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x2</span> <span class="id" title="var">v2</span>) <span class="id" title="var">x1</span> <span class="id" title="var">v1</span>.<br/>

<br/>
</div>

<div class="doc">
The following definition captures two stores <i>agreeing</i> on a
    given predicate <span class="inlinecode"><span class="id" title="var">phi</span></span> over (program) variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sAgree</span> (<span class="id" title="var">phi</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="keyword">Prop</span>)(<span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">Store</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2</span> <span class="id" title="var">x</span>.<br/>

<br/>
</div>

<div class="doc">
Store agreement is a symmetric relation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">sAgree_symm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phi</span>, <span class="id" title="var">Symmetric</span> (<span class="id" title="var">sAgree</span> <span class="id" title="var">phi</span>).<br/>

<br/>
</div>

<div class="doc">
Below are several other useful properties of store agreement. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sAgree_split</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">phi1</span> <span class="id" title="var">phi2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">phi1</span> <span class="id" title="var">x</span> \/ <span class="id" title="var">phi2</span> <span class="id" title="var">x</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> <span class="id" title="var">phi1</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> /\ <span class="id" title="var">sAgree</span> <span class="id" title="var">phi2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sAgree_app</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">xs1</span> <span class="id" title="var">xs2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">xs1</span> ++ <span class="id" title="var">xs2</span>)) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs1</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> /\<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs2</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">sAgree_weaken</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">phi1</span> <span class="id" title="var">phi2</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="keyword">Prop</span>)(<span class="id" title="var">s1</span> <span class="id" title="var">s2</span> : <span class="id" title="var">Store</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi1</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">phi2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> <span class="id" title="var">phi2</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> <span class="id" title="var">phi1</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab161"></a><h3 class="section">Denotational semantics</h3>

<div class="paragraph"> </div>

<a name="lab162"></a><h4 class="section">Expressions</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">expr_eval</span> (<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">Val</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Econst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Evar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">s</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Eop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">val_op</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">expr_eval_map</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Val</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> : <span class="id" title="var">T</span> =&gt; <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
Standard properties relating substitution to evaluation: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eval_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E2</span> <span class="id" title="var">E1</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> <span class="id" title="var">E2</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>)).<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eval_subst_map</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>) <span class="id" title="var">E</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval_map</span> (<span class="id" title="var">expr_subst_map</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">f</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval_map</span> <span class="id" title="var">f</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)).<br/>

<br/>
</div>

<div class="doc">
The following lemma relates the evaluation of
    process expressions with the evaluation of
    program expressions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eval_conv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">e</span> : <span class="id" title="var">ProcExpr</span>)(<span class="id" title="var">ps</span> : <span class="id" title="var">ProcStore</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">ProcVar</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">pexpr_fv</span> <span class="id" title="var">e</span>) -&gt; <span class="id" title="var">ps</span> <span class="id" title="var">x</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> (<span class="id" title="var">pexpr_convert</span> <span class="id" title="var">e</span> <span class="id" title="var">f</span>) <span class="id" title="var">s</span> = <span class="id" title="var">pexpr_eval</span> <span class="id" title="var">e</span> <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluation of expressions only depends on its free variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>)) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s1</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s2</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_map_agree</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">f</span> : <span class="id" title="var">T</span> -&gt; <span class="id" title="var">Expr</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">expr_map_fv</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval_map</span> <span class="id" title="var">f</span> <span class="id" title="var">s1</span> = <span class="id" title="var">expr_eval_map</span> <span class="id" title="var">f</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
The following lemma relates expression evaluation to store updates. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eval_upd</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_fv</span> <span class="id" title="var">E</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
Other useful properties of expression evaluation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">expr_eval_const</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>, <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">Econst</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)) <span class="id" title="var">s</span>.<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab163"></a><h4 class="section">Conditions</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cond_eval</span> (<span class="id" title="var">B</span> : <span class="id" title="var">Cond</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bconst</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Bnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">negb</span> (<span class="id" title="var">cond_eval</span> <span class="id" title="var">B'</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Band</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; (<span class="id" title="var">cond_eval</span> <span class="id" title="var">B1</span> <span class="id" title="var">s</span>) &amp;&amp; (<span class="id" title="var">cond_eval</span> <span class="id" title="var">B2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Beq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="keyword">if</span> <span class="id" title="var">val_eq_dec</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">true</span> <span class="id" title="keyword">else</span> <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_eval_excl</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>, <span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">true</span> \/ <span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">false</span>.<br/>

<br/>
</div>

<div class="doc">
A standard property that relates substitution to evaluation: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_eval_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">E</span> <span class="id" title="var">x</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)).<br/>

<br/>
</div>

<div class="doc">
The following lemma relates the evaluation of process conditions
    with the evaluation of program conditions. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_eval_conv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">b</span> : <span class="id" title="var">ProcCond</span>)(<span class="id" title="var">ps</span> : <span class="id" title="var">ProcStore</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">ProcVar</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">pcond_fv</span> <span class="id" title="var">b</span>) -&gt; <span class="id" title="var">ps</span> <span class="id" title="var">x</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">pcond_convert</span> <span class="id" title="var">b</span> <span class="id" title="var">f</span>) <span class="id" title="var">s</span> = <span class="id" title="var">pcond_eval</span> <span class="id" title="var">b</span> <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
The evaluation of conditions only depends on its free variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>)) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s1</span> = <span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
The following lemma relates condition evaluation to store updates. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cond_eval_upd</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">cond_fv</span> <span class="id" title="var">B</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) = <span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab164"></a><h3 class="section">Hybrid expressions</h3>

<div class="paragraph"> </div>

<a name="lab165"></a><h4 class="section">Dehybridisation</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">eDehybridise</span> (<span class="id" title="var">E</span> : <span class="id" title="var">HExpr</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">ProcExpr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">E</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">PEconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">PEvar</span> <span class="id" title="var">x</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">PEconst</span> (<span class="id" title="var">s</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEop</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">PEop</span> (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The following two properties relate hybridisation to evaluation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eHybridise_eval</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pexpr_eval</span> (<span class="id" title="var">eDehybridise</span> (<span class="id" title="var">eHybridise</span> <span class="id" title="var">E</span>) <span class="id" title="var">s</span>) <span class="id" title="var">ps</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eHybridise_conv_eval</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span> (<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">ProcVar</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E</span>) -&gt; <span class="id" title="var">ps</span> <span class="id" title="var">x</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">expr_eval</span> (<span class="id" title="var">hexpr_convert</span> <span class="id" title="var">E</span> <span class="id" title="var">f</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">pexpr_eval</span> (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
Dehybridising a hybridised process expression gives
    the original process expression 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eDehybridise_hybridise</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">e</span> <span class="id" title="var">s</span>, <span class="id" title="var">e</span> = <span class="id" title="var">eDehybridise</span> (<span class="id" title="var">peHybridise</span> <span class="id" title="var">e</span>) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
The following property related dehybrisation
    to freely occuring process variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eDehybridise_fpv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hexpr_fpv</span> <span class="id" title="var">E</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">pexpr_fv</span> (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab166"></a><h4 class="section">Substitution</h4>

<div class="paragraph"> </div>

 Substitution is defined in the standard sense. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hexpr_subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">HE</span> : <span class="id" title="var">HExpr</span>) : <span class="id" title="var">HExpr</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">HE</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HEconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprocvar</span> <span class="id" title="var">y</span> =&gt; <span class="id" title="var">HEprocvar</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEprogvar</span> <span class="id" title="var">y</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">var_eq_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">eHybridise</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">HEprogvar</span> <span class="id" title="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HEop</span> <span class="id" title="var">HE1</span> <span class="id" title="var">HE2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HEop</span> (<span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">HE1</span>) (<span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">HE2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Substituting any (program) variable that does not occur
    freely inside the targetted hybrid expression
    does not change the expression. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hexpr_subst_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">HE</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hexpr_fv</span> <span class="id" title="var">HE</span>) -&gt; <span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">HE</span> = <span class="id" title="var">HE</span>.<br/>

<br/>
</div>

<div class="doc">
The following property relates dehybridisation to substitution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eDehybridise_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">HE</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pexpr_eval</span> (<span class="id" title="var">eDehybridise</span> (<span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">HE</span>) <span class="id" title="var">s</span>) <span class="id" title="var">ps</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">pexpr_eval</span> (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">HE</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>))) <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
The dehybridisation of hybrid expressions
    only depends on its free variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">eDehybridise_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">E</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hexpr_fv</span> <span class="id" title="var">E</span>)) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E</span> <span class="id" title="var">s1</span> = <span class="id" title="var">eDehybridise</span> <span class="id" title="var">E</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab167"></a><h3 class="section">Hybrid conditions</h3>

<div class="paragraph"> </div>

<a name="lab168"></a><h4 class="section">Dehybridisation</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cDehybridise</span> (<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">ProcCond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBconst</span> <span class="id" title="var">b</span> =&gt; <span class="id" title="var">PBconst</span> <span class="id" title="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">PBnot</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B'</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBand</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">PBand</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBeq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">PBeq</span> (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">eDehybridise</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The following two properties relate hybridisation to evaluation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cHybridise_eval</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pcond_eval</span> (<span class="id" title="var">cDehybridise</span> (<span class="id" title="var">cHybridise</span> <span class="id" title="var">B</span>) <span class="id" title="var">s</span>) <span class="id" title="var">ps</span> = <span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cHybridise_conv_eval</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span> (<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Expr</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span> : <span class="id" title="var">ProcVar</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hcond_fpv</span> <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">ps</span> <span class="id" title="var">x</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">hcond_convert</span> <span class="id" title="var">B</span> <span class="id" title="var">f</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">pcond_eval</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>) <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
Dehybridising a hybridised process condition gives
    the same condition 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cDehybridise_hybridise</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> <span class="id" title="var">s</span>, <span class="id" title="var">b</span> = <span class="id" title="var">cDehybridise</span> (<span class="id" title="var">pcHybridise</span> <span class="id" title="var">b</span>) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
The dehybridisation of hybrid conditions
    only depends on its free variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cDehybridise_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">x</span> =&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hcond_fv</span> <span class="id" title="var">B</span>)) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> <span class="id" title="var">s1</span> = <span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
The following property related dehybrisation
    to freely occuring process variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cDehybridise_fpv</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hcond_fpv</span> <span class="id" title="var">B</span>) &lt;-&gt; <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">pcond_fv</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab169"></a><h4 class="section">Substitution</h4>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hcond_subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">B</span> : <span class="id" title="var">HCond</span>) : <span class="id" title="var">HCond</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">B</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBconst</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">HBconst</span> <span class="id" title="var">v</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBnot</span> <span class="id" title="var">B'</span> =&gt; <span class="id" title="var">HBnot</span> (<span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBand</span> <span class="id" title="var">B1</span> <span class="id" title="var">B2</span> =&gt; <span class="id" title="var">HBand</span> (<span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B1</span>) (<span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HBeq</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> =&gt; <span class="id" title="var">HBeq</span> (<span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E1</span>) (<span class="id" title="var">hexpr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Substituting any (program) variable that does not occur
    freely inside the targetted hybrid condition
    does not change the targetted condition. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hcond_subst_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">In</span> <span class="id" title="var">x</span> (<span class="id" title="var">hcond_fv</span> <span class="id" title="var">B</span>) -&gt; <span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span> = <span class="id" title="var">B</span>.<br/>

<br/>
</div>

<div class="doc">
The following property relates dehybridisation to substitution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cDehybridise_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">B</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="var">ps</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pcond_eval</span> (<span class="id" title="var">cDehybridise</span> (<span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span>) <span class="id" title="var">s</span>) <span class="id" title="var">ps</span> =<br/>
&nbsp;&nbsp;<span class="id" title="var">pcond_eval</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>))) <span class="id" title="var">ps</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab170"></a><h3 class="section">Hybrid processes</h3>

<div class="paragraph"> </div>

 The following two functions, <span class="inlinecode"><span class="id" title="var">hguard</span></span> and <span class="inlinecode"><span class="id" title="var">heffect</span></span>,
    are the hybrid counterparts of the functions
    <span class="inlinecode"><span class="id" title="var">guard</span></span> and <span class="inlinecode"><span class="id" title="var">effect</span></span> that constituting the
    guards and effects of actions 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">hguard</span> : <span class="id" title="var">Act</span> -&gt; <span class="id" title="var">Expr</span> -&gt; <span class="id" title="var">HCond</span>.<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">heffect</span> : <span class="id" title="var">Act</span> -&gt; <span class="id" title="var">Expr</span> -&gt; <span class="id" title="var">HCond</span>.<br/>

<br/>
</div>

<div class="doc">
We need to make sure that the hybrid guards and effects
    make sense with respect to the ordinary guards and effects
    of actions. This is done in terms of the following properties: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">hguard_corr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">hcond_convert</span> (<span class="id" title="var">hguard</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span>) <span class="id" title="var">f</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">pcond_convert</span> (<span class="id" title="var">guard</span> <span class="id" title="var">a</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)) <span class="id" title="var">f</span>) <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Parameter</span> <span class="id" title="var">heffect_corr</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">hcond_convert</span> (<span class="id" title="var">heffect</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span>) <span class="id" title="var">f</span>) <span class="id" title="var">s</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> (<span class="id" title="var">pcond_convert</span> (<span class="id" title="var">effect</span> <span class="id" title="var">a</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)) <span class="id" title="var">f</span>) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab171"></a><h4 class="section">(De)hybridisation</h4>

<div class="paragraph"> </div>

 The dehybridisation operation <span class="inlinecode"><span class="id" title="var">pDehybridise</span></span> for processes
    transforms any hybrid process to an ordinary process: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">pDehybridise</span> (<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>) : <span class="id" title="var">Proc</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">P</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPepsilon</span> =&gt; <span class="id" title="var">Pepsilon</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPdelta</span> =&gt; <span class="id" title="var">Pdelta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPact</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">Pact</span> <span class="id" title="var">a</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPassert</span> <span class="id" title="var">B</span> =&gt; <span class="id" title="var">Passert</span> (<span class="id" title="var">cDehybridise</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPseq</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">Pseq</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPalt</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">Palt</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPpar</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">Ppar</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPlmerge</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">Plmerge</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P2</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPsum</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">Psum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">pDehybridise</span> (<span class="id" title="var">f</span> <span class="id" title="var">v</span>) <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPcond</span> <span class="id" title="var">B</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">Pcond</span> (<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">Q</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPiter</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">Piter</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">Q</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Dehybridising a hybridised process yields the original process. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pDehybridise_hybridise</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">s</span>, <span class="id" title="var">P</span> = <span class="id" title="var">pDehybridise</span> (<span class="id" title="var">pHybridise</span> <span class="id" title="var">P</span>) <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
The dehybridisation of hybrid processes
    only depends on its free variables. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pDehybridise_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="var">hproc_fv</span> <span class="id" title="var">P</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P</span> <span class="id" title="var">s1</span> = <span class="id" title="var">pDehybridise</span> <span class="id" title="var">P</span> <span class="id" title="var">s2</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab172"></a><h4 class="section">Substitution</h4>

<div class="paragraph"> </div>

 The substitution operation <span class="inlinecode"><span class="id" title="var">hproc_subst</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">E</span></span> <span class="inlinecode"><span class="id" title="var">P</span></span> replaces
    every occurence of the <i>program</i> variable <span class="inlinecode"><span class="id" title="var">x</span></span> by the
    expression <span class="inlinecode"><span class="id" title="var">E</span></span> inside the hybrid process <span class="inlinecode"><span class="id" title="var">P</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">hproc_subst</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">E</span> : <span class="id" title="var">Expr</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>) : <span class="id" title="var">HProc</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">P</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPepsilon</span> =&gt; <span class="id" title="var">HPepsilon</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPdelta</span> =&gt; <span class="id" title="var">HPdelta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPact</span> <span class="id" title="var">a</span> <span class="id" title="var">E'</span> =&gt; <span class="id" title="var">HPact</span> <span class="id" title="var">a</span> (<span class="id" title="var">expr_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">E'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPassert</span> <span class="id" title="var">B</span> =&gt; <span class="id" title="var">HPassert</span> (<span class="id" title="var">hcond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPseq</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">HPseq</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P1</span>) (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPalt</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">HPalt</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P1</span>) (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPpar</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">HPpar</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P1</span>) (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPlmerge</span> <span class="id" title="var">P1</span> <span class="id" title="var">P2</span> =&gt; <span class="id" title="var">HPlmerge</span>  (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P1</span>) (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPsum</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="var">HPsum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> (<span class="id" title="var">f</span> <span class="id" title="var">v</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPcond</span> <span class="id" title="var">B</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">HPcond</span> (<span class="id" title="var">cond_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">B</span>) (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">HPiter</span> <span class="id" title="var">Q</span> =&gt; <span class="id" title="var">HPiter</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">Q</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The definition of sigma as used in the process algebra
    literature to define summation can now be encoded
    op top of substitution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">HPsigma</span> (<span class="id" title="var">x</span> : <span class="id" title="var">Var</span>)(<span class="id" title="var">P</span> : <span class="id" title="var">HProc</span>) : <span class="id" title="var">HProc</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">HPsum</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">v</span> =&gt; <span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> (<span class="id" title="var">Econst</span> <span class="id" title="var">v</span>) <span class="id" title="var">P</span>).<br/>

<br/>
</div>

<div class="doc">
Substituting any (program) variable that does not occur
    freely inside the targetted hybrid process
    does not change the targetted process. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">hproc_subst_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">hproc_fv</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> -&gt; (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P</span>) = <span class="id" title="var">P</span>.<br/>

<br/>
</div>

<div class="doc">
The following property relates substitution with
    the dehybridisation of hybrid processes. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pDehybridise_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">bisim</span> (<span class="id" title="var">pDehybridise</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P</span>) <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>))).<br/>

<br/>
</div>

<div class="doc">
<a name="lab173"></a><h3 class="section">Hybrid process bisimilarity</h3>

<div class="paragraph"> </div>

 Bisimilarity of hybrid processes is lifted from the
    definition of bisimilarity <span class="inlinecode"><span class="id" title="var">bisim</span></span> of (ordinary) processes. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hbisim</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> : <span class="id" title="var">HProc</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">s</span>, <span class="id" title="var">bisim</span> (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">P</span> <span class="id" title="var">s</span>) (<span class="id" title="var">pDehybridise</span> <span class="id" title="var">Q</span> <span class="id" title="var">s</span>).<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">hbisim_f</span> : <span class="id" title="var">relation</span> (<span class="id" title="var">Val</span> -&gt; <span class="id" title="var">HProc</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">pointwise_relation</span> <span class="id" title="var">Val</span> <span class="id" title="var">hbisim</span>.<br/>

<br/>
<span class="id" title="keyword">Notation</span> &quot;P  Q" := (<span class="id" title="var">hbisim</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>
<span class="id" title="keyword">Notation</span> &quot;f  g" := (<span class="id" title="var">hbisim_f</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>) (<span class="id" title="var">only</span> <span class="id" title="var">printing</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80).<br/>

<br/>
</div>

<div class="doc">
Bisimilarity of hybrid processes is an equivalence relation. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_refl</span> : <span class="id" title="var">Reflexive</span> <span class="id" title="var">hbisim</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_symm</span> : <span class="id" title="var">Symmetric</span> <span class="id" title="var">hbisim</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_trans</span>  : <span class="id" title="var">Transitive</span> <span class="id" title="var">hbisim</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_equiv</span> : <span class="id" title="var">Equivalence</span> <span class="id" title="var">hbisim</span>.<br/>
 
<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">hbisim_refl</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_f_refl</span> : <span class="id" title="var">Reflexive</span> <span class="id" title="var">hbisim_f</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_f_symm</span> : <span class="id" title="var">Symmetric</span> <span class="id" title="var">hbisim_f</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_f_trans</span> : <span class="id" title="var">Transitive</span> <span class="id" title="var">hbisim_f</span>.<br/>
 <span class="id" title="keyword">Global Instance</span> <span class="id" title="var">hbisim_f_equiv</span> : <span class="id" title="var">Equivalence</span> <span class="id" title="var">hbisim_f</span>.<br/>
 
<br/>
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">hbisim_f_refl</span> : <span class="id" title="var">core</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">pDehybridise</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">bisim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">pDehybridise_bisim_mor</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab174"></a><h3 class="section">Congruence properties of hybrid processes</h3>

<div class="paragraph"> </div>

 Bisimilarity of hybrid processes is a <i>congruence</i>
    for all process-algebraic connectives (this is entirely derived
    from the congruence properties of <span class="inlinecode"><span class="id" title="var">bisim</span></span>). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPseq</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_seq</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPalt</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_alt</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPpar</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_par</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPlmerge</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_lmerge</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPsum</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim_f</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_sum</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPcond</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_cond</span>.<br/>
 <span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">HPiter</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">hbisim</span> ==&gt; <span class="id" title="var">hbisim</span> <span class="id" title="keyword">as</span> <span class="id" title="var">hbisim_iter</span>.<br/>
 
<br/>
</div>

<div class="doc">
<a name="lab175"></a><h3 class="section">Axiomatisation of hybrid processes</h3>

<div class="paragraph"> </div>

 All standard bisimulation equivalences can be derived
    from the definition of <span class="inlinecode"><span class="id" title="var">bisim</span></span>. 
<div class="paragraph"> </div>

 The most important equivalences for the remaining theory
    are associativity and commutativity of parallel composition,
    which are given below. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hbisim_par_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span>, <span class="id" title="var">hbisim</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">P</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span>)) (<span class="id" title="var">HPpar</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) <span class="id" title="var">R</span>).<br/>
 <span class="id" title="keyword">Theorem</span> <span class="id" title="var">hbisim_par_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>, <span class="id" title="var">hbisim</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>) (<span class="id" title="var">HPpar</span> <span class="id" title="var">Q</span> <span class="id" title="var">P</span>).<br/>
 <span class="id" title="keyword">Theorem</span> <span class="id" title="var">hbisim_par_epsilon_l</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span>, <span class="id" title="var">hbisim</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">HPepsilon</span> <span class="id" title="var">P</span>) <span class="id" title="var">P</span>.<br/>
 <span class="id" title="keyword">Theorem</span> <span class="id" title="var">hbisim_par_epsilon_r</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span>, <span class="id" title="var">hbisim</span> (<span class="id" title="var">HPpar</span> <span class="id" title="var">P</span> <span class="id" title="var">HPepsilon</span>) <span class="id" title="var">P</span>.<br/>
 
<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">hbisim_sigma_alt</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">hbisim</span> (<span class="id" title="var">HPsigma</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span>) (<span class="id" title="var">HPalt</span> (<span class="id" title="var">hproc_subst</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">P</span>) (<span class="id" title="var">HPsigma</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab176"></a><h3 class="section">Shared memory accesses</h3>

<div class="paragraph"> </div>

 The operation <span class="inlinecode"><span class="id" title="var">cmd_acc</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> defines the set of heap locations
    that are <i>accessed</i> by the program <span class="inlinecode"><span class="id" title="var">C</span></span> in a single execution step,
    where <span class="inlinecode"><span class="id" title="var">s</span></span> is used to evaluate all expressions referring
    to heap locations. 
<div class="paragraph"> </div>

 Likewise, the operation <span class="inlinecode"><span class="id" title="var">cmd_writes</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> determines the set
    of heap locations that are <i>written to</i> by <span class="inlinecode"><span class="id" title="var">C</span></span>
    in a single execution step. Note that, rather than yielding
    a set of heap locations, both these operations are defined
    as predicates instead for later convenience. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_acc</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C'</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">_</span> <span class="id" title="var">E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">E</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">l</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">l</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> =&gt; <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> /\ <span class="id" title="var">l</span> = <span class="id" title="var">expr_eval</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">cmd_writes</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>)(<span class="id" title="var">s</span> : <span class="id" title="var">Store</span>)(<span class="id" title="var">l</span> : <span class="id" title="var">Val</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">C</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cskip</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cseq</span> <span class="id" title="var">C'</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cass</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cread</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwrite</span> <span class="id" title="var">E</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">l</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cite</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cwhile</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> =&gt; <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span> \/ <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Calloc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span> =&gt; <span class="id" title="var">l</span> = <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Catomic</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cproc</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cact</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cinact</span> <span class="id" title="var">_</span> <span class="id" title="var">C'</span> =&gt; <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C'</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cquery</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Cendproc</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
All writes to shared memory are also shared-memory accesses. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_writes_acc</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">s</span> <span class="id" title="var">l</span>, <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span> -&gt; <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C</span> <span class="id" title="var">s</span> <span class="id" title="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
Other useful properties of shared-memory accesses. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_acc_agree</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_acc</span> <span class="id" title="var">C</span> <span class="id" title="var">s1</span> <span class="id" title="var">l</span> = <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C</span> <span class="id" title="var">s2</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_writes_agree</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_writes</span> <span class="id" title="var">C</span> <span class="id" title="var">s1</span> <span class="id" title="var">l</span> = <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C</span> <span class="id" title="var">s2</span> <span class="id" title="var">l</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_acc_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">s</span>, <span class="id" title="var">cmd_acc</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) <span class="id" title="var">s</span> = <span class="id" title="var">cmd_acc</span> <span class="id" title="var">C</span> <span class="id" title="var">s</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cmd_writes_plain</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_writes</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) <span class="id" title="var">s</span> = <span class="id" title="var">cmd_writes</span> <span class="id" title="var">C</span> <span class="id" title="var">s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab177"></a><h3 class="section">Operational semantics</h3>

<div class="paragraph"> </div>

 Below are the small-step reduction rules of the (standard)
    operational semantics of programs. 
<div class="paragraph"> </div>

 Observe that the process-related commands are ignored
    and handled as if they were comments, since these are
    specification-only. Moreover, the transition rules for the
    parallel composition only allow a program to make a step if the
    other program is not locked. This allows to model atomic programs
    using a small-step semantics. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">step</span> : <span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">PlainCmd</span> -&gt; <span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">PlainCmd</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_seq_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C1'</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C1'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1'</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_seq_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">Cskip</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_assign</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cass</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) <span class="id" title="var">h</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_read</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">v</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) <span class="id" title="var">h</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_write</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> <span class="id" title="var">v</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v'</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> (<span class="id" title="var">Some</span> <span class="id" title="var">v'</span>)) <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_ite_t</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">step_ite_f</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_while</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C</span> (<span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>)) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_alloc</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> (<span class="id" title="var">Some</span> <span class="id" title="var">v</span>)) (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">step_dispose</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> <span class="id" title="var">None</span>) <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_atom</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Catomic</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_inatom_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_inatom_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_par_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C1'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C1'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1'</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_par_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C2'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C2'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_par_done</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">Cskip</span> <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_proc_init</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">X</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cproc</span> <span class="id" title="var">X</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">step_end</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">X</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cendproc</span> <span class="id" title="var">X</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_act</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cact</span> <span class="id" title="var">X</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">PMnone</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_act_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">PMnone</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">PMnone</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_act_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">PMnone</span> <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">step_query</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cquery</span> <span class="id" title="var">x</span>) <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">Cskip</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "step_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "step_sind".<br/>

<br/>
</div>

<div class="doc">
Program basicality, program well-formedness
    and heap finiteness all remain invariant
    during program execution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_basic_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_basic</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt; <span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_wf_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_wf</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt; <span class="id" title="var">cmd_wf</span> <span class="id" title="var">C'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_hFinite</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt; <span class="id" title="var">hFinite</span> <span class="id" title="var">h</span> -&gt; <span class="id" title="var">hFinite</span> <span class="id" title="var">h'</span>.<br/>

<br/>
</div>

<div class="doc">
The sets of free and modified variables do not grow
    during program execution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_fv_mod</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, ~ <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s</span> <span class="id" title="var">x</span> = <span class="id" title="var">s'</span> <span class="id" title="var">x</span>).<br/>

<br/>
</div>

<div class="doc">
Program execution commutes with store agreement: 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s1'</span> (<span class="id" title="var">phi</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">phi</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sAgree</span> <span class="id" title="var">phi</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s1</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s1'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">s2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">sAgree</span> <span class="id" title="var">phi</span> <span class="id" title="var">s1'</span> <span class="id" title="var">s2'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s2</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s2'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
</div>

<div class="doc">
A program reduction step always mutates the executed program;
    one does not end up in the same program after performing a
    computation step. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">step_neg_C</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>, ~ <span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab178"></a><h3 class="section">Fault semantics</h3>

<div class="paragraph"> </div>

 The fault semantics of program is defined in
    terms of the predicate <span class="inlinecode"><span class="id" title="var">fault</span></span> <span class="inlinecode"><span class="id" title="var">h</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">C</span></span> and captures
    whether <span class="inlinecode"><span class="id" title="var">C</span></span> is able to <i>fault</i> in a single computation
    step with respect to heap <span class="inlinecode"><span class="id" title="var">h</span></span> and store <span class="inlinecode"><span class="id" title="var">s</span></span>. 
<div class="paragraph"> </div>

 A <i>fault</i> is defined to be a data-race, a deadlock,
    or a violation of memory safety. 
<div class="paragraph"> </div>

 Any program performs a <i>data-race</i> if two threads
    access the same shared location,
    where one of these accesses is a write. 
<div class="paragraph"> </div>

 Any parallel program <span class="inlinecode"><span class="id" title="var">Cpar</span></span> <span class="inlinecode"><span class="id" title="var">C1</span></span> <span class="inlinecode"><span class="id" title="var">C2</span></span> is <i>deadlocked</i> if
    <span class="inlinecode"><span class="id" title="var">C1</span></span> and <span class="inlinecode"><span class="id" title="var">C2</span></span> are both locked with respect to <span class="inlinecode"><span class="id" title="var">cmd_locked</span></span>. 
<div class="paragraph"> </div>

 Moreover, any program is defined to be <i>memory safe</i>
    if it does not access a shared location has has not
    been allocated. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">fault</span> {<span class="id" title="var">T</span>} : <span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_read</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_write</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_alloc</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">None</span>) -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_dispose</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_par_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> -&gt; ~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_par_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C2</span> -&gt; ~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_deadlock</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt; <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_act</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_seq</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_atom</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_race_l</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">disjoint</span> (<span class="id" title="var">cmd_writes</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">cmd_acc</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">fault_race_r</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">disjoint</span> (<span class="id" title="var">cmd_acc</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">cmd_writes</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "fault_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "fault_sind".<br/>

<br/>
</div>

<div class="doc">
The fault semantics of programs is closed under store agreement. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fault_agree</span> {<span class="id" title="var">T</span>} :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">C</span> : <span class="id" title="var">Cmd</span> <span class="id" title="var">T</span>) <span class="id" title="var">h</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s1</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s2</span> <span class="id" title="var">C</span>.<br/>

<br/>
</div>

<div class="doc">
The following theorem shows that the operational semantics
    and fault semantics are coherent, by showing a property
    of progress: every configuration that does not fault
    can either make a computation step or has already terminated. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">step_progress</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">C</span> = <span class="id" title="var">Cskip</span> \/ <span class="id" title="tactic">exists</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>, <span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab179"></a><h2 class="section">Ghost operational semantics</h2>

<div class="paragraph"> </div>

 The <i>ghost operational semantics</i> of (ghost) programs is the
    lock-step execution of the (ordinary) operational semantics of
    programs and the execution of all its process-algebraic models. 
<div class="paragraph"> </div>

 Ghost commands are programs that maintain some extra metadata.
    In particular, every partially executed action program holds
    (1) the corresponding process identifier, (2) the action that is
    being executed, and (3) a <i>snapshot</i> of the heap made when the
    action block started to be executed. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">GhostMetadata</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">GMdata</span>(<span class="id" title="var">pid</span> : <span class="id" title="var">Val</span>)(<span class="id" title="var">a</span> : <span class="id" title="var">Act</span>)(<span class="id" title="var">v</span> : <span class="id" title="var">Val</span>)(<span class="id" title="var">hs</span> : <span class="id" title="var">Heap</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "GhostMetadata_rect".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "GhostMetadata_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "GhostMetadata_rec".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "GhostMetadata_sind".<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">GhostCmd</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Cmd</span> <span class="id" title="var">GhostMetadata</span>.<br/>

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">gstep</span> : <span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">ProcMap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">GhostCmd</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">ProcMap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">GhostCmd</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_seq_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">Cskip</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_seq_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C1'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C1'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1'</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_assign</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cass</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_read</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">v</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">v</span>) <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_write</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> <span class="id" title="var">v</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v'</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E2</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> (<span class="id" title="var">Some</span> <span class="id" title="var">v'</span>)) <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_ite_t</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_ite_f</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cond_eval</span> <span class="id" title="var">B</span> <span class="id" title="var">s</span> = <span class="id" title="var">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C2</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_while</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cite</span> <span class="id" title="var">B</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C</span> (<span class="id" title="var">Cwhile</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>)) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_alloc</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> <span class="id" title="var">l</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> : <span class="id" title="var">Val</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> (<span class="id" title="var">Some</span> <span class="id" title="var">v</span>)) <span class="id" title="var">pm</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">l</span>) <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_dispose</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">l</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span>) (<span class="id" title="var">hUpdate</span> <span class="id" title="var">h</span> <span class="id" title="var">l</span> <span class="id" title="var">None</span>) <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_atom</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Catomic</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_inatom_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_inatom_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_par_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C1'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C1'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1'</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_par_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C2'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C2</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C2'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>) <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_par_done</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">Cskip</span> <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_proc_init</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">Pf</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> <span class="id" title="var">pid</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pm</span> <span class="id" title="var">pid</span> = <span class="id" title="var">PEfree</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">HP</span> := <span class="id" title="var">Pf</span> <span class="id" title="var">E</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">P</span> := <span class="id" title="var">pDehybridise</span> <span class="id" title="var">HP</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">f'</span> := <span class="id" title="var">expr_eval_map</span> <span class="id" title="var">f</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cproc</span> <span class="id" title="var">x</span> <span class="id" title="var">Pf</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) <span class="id" title="var">h</span> (<span class="id" title="var">pmUpdate</span> <span class="id" title="var">pm</span> <span class="id" title="var">pid</span> (<span class="id" title="var">PEelem</span> <span class="id" title="var">perm_full</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f'</span>)) <span class="id" title="var">s</span> (<span class="id" title="var">sUpdate</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">pid</span>) <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_proc_end</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pid</span> := <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">perm_full</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pterm</span> <span class="id" title="var">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cendproc</span> <span class="id" title="var">x</span>) <span class="id" title="var">h</span> (<span class="id" title="var">pmUpdate</span> <span class="id" title="var">pm</span> <span class="id" title="var">pid</span> <span class="id" title="var">PEfree</span>) <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_act</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">v</span> := <span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">m</span> := <span class="id" title="var">GMdata</span> (<span class="id" title="var">g</span> <span class="id" title="var">x</span>) <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">h</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cact</span> <span class="id" title="var">x</span> <span class="id" title="var">a</span> <span class="id" title="var">E</span> <span class="id" title="var">C</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_act_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">m</span> <span class="id" title="var">C'</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_act_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">P'</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> <span class="id" title="var">ps1</span> <span class="id" title="var">ps2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">hs</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps1</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps2</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pstep</span> <span class="id" title="var">P</span> <span class="id" title="var">ps1</span> (<span class="id" title="var">PLact</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span>) <span class="id" title="var">P'</span> <span class="id" title="var">ps2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pm'</span> := <span class="id" title="var">pmUpdate</span> <span class="id" title="var">pm</span> <span class="id" title="var">pid</span> (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P'</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> (<span class="id" title="var">GMdata</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span>) <span class="id" title="var">Cskip</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span><br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gstep_query</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">pm</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> <span class="id" title="var">ps</span> <span class="id" title="var">P'</span> <span class="id" title="var">s</span> <span class="id" title="var">h</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pid</span> := <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pstep</span> <span class="id" title="var">P</span> <span class="id" title="var">ps</span> <span class="id" title="var">PLassert</span> <span class="id" title="var">P'</span> <span class="id" title="var">ps</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pm'</span> := <span class="id" title="var">pmUpdate</span> <span class="id" title="var">pm</span> <span class="id" title="var">pid</span> (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P'</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cquery</span> <span class="id" title="var">x</span>) <span class="id" title="var">h</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">Cskip</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "gstep_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "gstep_sind".<br/>

<br/>
</div>

<div class="doc">
The reduction rules of the standard operational semantics
    are embedded in the reduction rules of the ghost operational
    semantics, as is shown by the following theorem. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">gstep_sim</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>).<br/>

<br/>
</div>

<div class="doc">
Moreover, the ghost operational semantics can mimick
    the steps of the standard operational semantics
    for any basic program. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">step_basic_sim</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_basic</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">C''</span>, <span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm</span> <span class="id" title="var">s'</span> <span class="id" title="var">g</span> <span class="id" title="var">C''</span> /\ <span class="id" title="var">C'</span> = <span class="id" title="var">plain</span> <span class="id" title="var">C''</span>.<br/>

<br/>
</div>

<div class="doc">
Program basicality, well-formedness and process map finiteness
    all remain invariant during ghost program execution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_basic_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_basic</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_basic</span> <span class="id" title="var">C'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_wf_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_wf</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_wf</span> <span class="id" title="var">C'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_pmFinite_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">pmFinite</span> <span class="id" title="var">pm</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">pmFinite</span> <span class="id" title="var">pm'</span>.<br/>

<br/>
</div>

<div class="doc">
The ghost semantics can simulate computation steps
    made with bisimilar process maps. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_procmap_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm1</span> <span class="id" title="var">pm2</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm1'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmBisim</span> <span class="id" title="var">pm1</span> <span class="id" title="var">pm2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm1</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm1'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">pm2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm2</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm2'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmBisim</span> <span class="id" title="var">pm1'</span> <span class="id" title="var">pm2'</span>.<br/>

<br/>
</div>

<div class="doc">
The sets of free and modified variables do not grow
    during program ghost execution. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_fv_mod_g</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;~ <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">g</span> <span class="id" title="var">x</span> = <span class="id" title="var">g'</span> <span class="id" title="var">x</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_fv_mod</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C'</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, ~ <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s</span> <span class="id" title="var">x</span> = <span class="id" title="var">s'</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, ~ <span class="id" title="var">cmd_mod</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">g</span> <span class="id" title="var">x</span> = <span class="id" title="var">g'</span> <span class="id" title="var">x</span>).<br/>

<br/>
</div>

<div class="doc">
Program ghost execution commutes with store agreement. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s1'</span> <span class="id" title="var">g'</span> (<span class="id" title="var">phi</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">phi</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s1'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">s2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1'</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2'</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s2'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_agree_g</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g1</span> <span class="id" title="var">g2</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g1'</span> (<span class="id" title="var">phi</span> : <span class="id" title="var">Var</span> -&gt; <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">phi</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">g1</span> <span class="id" title="var">x</span> = <span class="id" title="var">g2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g1</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g1'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">g2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">phi</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">g1'</span> <span class="id" title="var">x</span> = <span class="id" title="var">g2'</span> <span class="id" title="var">x</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g2</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g2'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
</div>

<div class="doc">
The following lemma is for later convenience. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_agree_sim</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s1'</span> <span class="id" title="var">s2'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span> <span class="id" title="var">x</span> -&gt; <span class="id" title="var">s1'</span> <span class="id" title="var">x</span> = <span class="id" title="var">s2'</span> <span class="id" title="var">x</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">step</span> <span class="id" title="var">h</span> <span class="id" title="var">s1</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) <span class="id" title="var">h'</span> <span class="id" title="var">s1'</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C'</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s2'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s1'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
</div>

<div class="doc">
Ghost steps in basic programs do not affect
    the ghost components <span class="inlinecode"><span class="id" title="var">pm</span></span> and <span class="inlinecode"><span class="id" title="var">g</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gstep_basic_ghostdata_pres</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">cmd_basic</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">pm</span> = <span class="id" title="var">pm'</span> /\ <span class="id" title="var">g</span> = <span class="id" title="var">g'</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab180"></a><h3 class="section">Ghost fault semantics</h3>

<div class="paragraph"> </div>

 The ghost fault semantics defines the notions of data-races
    and memory-safety, likewise to <span class="inlinecode"><span class="id" title="var">fault</span></span>, as well as all necessary
    conditions for a configuration in the ghost semantics to make
    progress (see <span class="inlinecode"><span class="id" title="var">gstep_progress</span></span> for the proof). 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">gfault</span> : <span class="id" title="var">Heap</span> -&gt; <span class="id" title="var">ProcMap</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">Store</span> -&gt; <span class="id" title="var">GhostCmd</span> -&gt; <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_read</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cread</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_write</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E1</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cwrite</span> <span class="id" title="var">E1</span> <span class="id" title="var">E2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_alloc</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="tactic">exists</span> <span class="id" title="var">l</span>, <span class="id" title="var">h</span> <span class="id" title="var">l</span> = <span class="id" title="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Calloc</span> <span class="id" title="var">x</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_dispose</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">E</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">h</span> (<span class="id" title="var">expr_eval</span> <span class="id" title="var">E</span> <span class="id" title="var">s</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cdispose</span> <span class="id" title="var">E</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_seq</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cseq</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_atom</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinatom</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_par_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_par_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_par_deadlock</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_act_step</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> <span class="id" title="var">m</span> <span class="id" title="var">C</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_act_end_1</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="var">pmeOcc</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> (<span class="id" title="var">GMdata</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span>) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_act_end_2</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> /\ <span class="id" title="var">hs</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> (<span class="id" title="var">GMdata</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span>) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_act_end_3</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> /\ <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> (<span class="id" title="var">GMdata</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span>) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_act_end_4</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> <span class="id" title="var">ps1</span> <span class="id" title="var">ps2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">hs</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps1</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps2</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="tactic">exists</span> <span class="id" title="var">P'</span>, <span class="id" title="var">pstep</span> <span class="id" title="var">P</span> <span class="id" title="var">ps1</span> (<span class="id" title="var">PLact</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span>) <span class="id" title="var">P'</span> <span class="id" title="var">ps2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cinact</span> (<span class="id" title="var">GMdata</span> <span class="id" title="var">pid</span> <span class="id" title="var">a</span> <span class="id" title="var">v</span> <span class="id" title="var">hs</span>) <span class="id" title="var">Cskip</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_proc_init</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="tactic">exists</span> <span class="id" title="var">pid</span>, <span class="id" title="var">pm</span> <span class="id" title="var">pid</span> = <span class="id" title="var">PEfree</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cproc</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">E</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_proc_end_1</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">pmeEntire</span> (<span class="id" title="var">pm</span> (<span class="id" title="var">g</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cendproc</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_proc_end_2</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> (<span class="id" title="var">g</span> <span class="id" title="var">x</span>)) (<span class="id" title="var">PEelem</span> <span class="id" title="var">perm_full</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">pterm</span> <span class="id" title="var">P</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cendproc</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_query_1</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pid</span> := <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="var">pmeOcc</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cquery</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_query_2</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pid</span> := <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">exists</span> <span class="id" title="var">y</span>, <span class="id" title="var">In</span> <span class="id" title="var">y</span> <span class="id" title="var">xs</span> /\ <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">y</span>) = <span class="id" title="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cquery</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_query_3</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span> <span class="id" title="var">ps</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">pid</span> := <span class="id" title="var">g</span> <span class="id" title="var">x</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pmeBisim</span> (<span class="id" title="var">pm</span> <span class="id" title="var">pid</span>) (<span class="id" title="var">PEelem</span> <span class="id" title="var">q</span> <span class="id" title="var">P</span> <span class="id" title="var">xs</span> <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">ps</span> <span class="id" title="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(~ <span class="id" title="tactic">exists</span> <span class="id" title="var">P'</span>, <span class="id" title="var">pstep</span> <span class="id" title="var">P</span> <span class="id" title="var">ps</span> (<span class="id" title="var">PLassert</span>) <span class="id" title="var">P'</span> <span class="id" title="var">ps</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cquery</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_race_l</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">disjoint</span> (<span class="id" title="var">cmd_writes</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">cmd_acc</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">gfault_race_r</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">cmd_locked</span> <span class="id" title="var">C2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id" title="var">disjoint</span> (<span class="id" title="var">cmd_acc</span> <span class="id" title="var">C1</span> <span class="id" title="var">s</span>) (<span class="id" title="var">cmd_writes</span> <span class="id" title="var">C2</span> <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> (<span class="id" title="var">Cpar</span> <span class="id" title="var">C1</span> <span class="id" title="var">C2</span>).<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "gfault_ind".<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="keyword">Search</span> <span class="id" title="var">Blacklist</span> "gfault_sind".<br/>

<br/>
</div>

<div class="doc">
The program fault semantics is embedded
    in the ghost fault semantics. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">fault_emb</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">fault</span> <span class="id" title="var">h</span> <span class="id" title="var">s</span> (<span class="id" title="var">plain</span> <span class="id" title="var">C</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span>.<br/>

<br/>
</div>

<div class="doc">
The following theorem shows that ghost reduction steps are
    <i>progressive</i> for non-faulty programs. Being progressive means
    that any ghost configuration that does not fault has either
    terminated or can make another computation step. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">heap_procvar_cover</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">ProcVar</span>)(<span class="id" title="var">h</span> : <span class="id" title="var">Heap</span>)(<span class="id" title="var">f</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Val</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) &lt;&gt; <span class="id" title="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">g</span> : <span class="id" title="var">ProcVar</span> -&gt; <span class="id" title="var">Val</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">x</span>, <span class="id" title="var">In</span> <span class="id" title="var">x</span> <span class="id" title="var">xs</span> -&gt; <span class="id" title="var">h</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span>) = <span class="id" title="var">Some</span> (<span class="id" title="var">g</span> <span class="id" title="var">x</span>).<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">gstep_progress</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span>,<br/>
&nbsp;&nbsp;~ <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" title="var">C</span> = <span class="id" title="var">Cskip</span> \/ <span class="id" title="tactic">exists</span> <span class="id" title="var">C'</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span>, <span class="id" title="var">gstep</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> <span class="id" title="var">h'</span> <span class="id" title="var">pm'</span> <span class="id" title="var">s'</span> <span class="id" title="var">g'</span> <span class="id" title="var">C'</span>.<br/>

<br/>
</div>

<div class="doc">
The faulting of ghost programs is stable under replacement
    of process maps with bisimilar ones, as well as replacement of
    (ghost) stores with stores that agree on all variables
    occuring freely in the program. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gfault_pmBisim</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm1</span> <span class="id" title="var">pm2</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">pmBisim</span> <span class="id" title="var">pm1</span> <span class="id" title="var">pm2</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm1</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm2</span> <span class="id" title="var">s</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> : <span class="id" title="var">gfault</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">with</span> <span class="id" title="var">signature</span> <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">pmBisim</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">eq</span> ==&gt; <span class="id" title="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> <span class="id" title="var">gfault_pmBisim_mor</span>.<br/>

<br/>
</div>

<div class="doc">
Ghost faults are dependent on variables
    occuring freely inside programs. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gfault_agree</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span>) <span class="id" title="var">s1</span> <span class="id" title="var">s2</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s1</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s2</span> <span class="id" title="var">g</span> <span class="id" title="var">C</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">gfault_agree_g</span> :<br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">C</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g1</span> <span class="id" title="var">g2</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">sAgree</span> (<span class="id" title="var">cmd_fv</span> <span class="id" title="var">C</span>) <span class="id" title="var">g1</span> <span class="id" title="var">g2</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g1</span> <span class="id" title="var">C</span> -&gt; <span class="id" title="var">gfault</span> <span class="id" title="var">h</span> <span class="id" title="var">pm</span> <span class="id" title="var">s</span> <span class="id" title="var">g2</span> <span class="id" title="var">C</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Programs</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>